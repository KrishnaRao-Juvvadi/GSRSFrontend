<mat-card>
  <!--mat-card-title>
    <a class="substance-name" [routerLink]="['/substances', substance.uuid]" matTooltip = "View substance details" >
      <span [innerHTML] = "substance._nameHTML"></span>
    </a>
    <mat-icon svgIcon="lock" class="lock-icon" *ngIf="substance.access && substance.access.length > 0">
    </mat-icon>
    <span class="middle-fill"></span-->
    <!--div class="approval">
      {{substance.approvalID}}
    </div-->
  <!--/mat-card-title-->

  <mat-card-content>
    <div class="substance-content">
      <div class="structure-container">
        <div *ngIf="substance.structure">
          <div class="mat-chip-list-container" *ngIf="substance.structure.stereochemistry">
            <mat-chip-list selectable="false" multiple="false">
              <mat-chip color="primary" selected>{{substance.structure.stereochemistry}}</mat-chip>
            </mat-chip-list>
          </div>
        </div>
        <div *ngIf="!substance.structure">
          <div class="mat-chip-list-container">
            <mat-chip-list selectable="false" multiple="false">
             <!-- <mat-chip color="primary" selected>{{substance.substanceClass | facetDisplay: 'types' | uppercase}}</mat-chip>-->
            </mat-chip-list>
          </div>
        </div>
        <div class="image-thumbnail">
          <div *ngIf="substance.structure || substance.polymer">
            <a class="zoom" (click)="openImageModal(substance)">
              <img appSubstanceImage [entityId]="substance.uuid"  [atomMaps]="substance._matchContext && substance._matchContext.atomMaps || null">
            </a>
          </div>
          <div *ngIf="!substance.structure && !substance.polymer">
         <!--   <img appSubstanceImage [entityId]="substance.uuid" [atomMaps]="substance._matchContext && substance._matchContext.atomMaps || null">-->
          </div>
        </div>
        <div *ngIf = "substance._matchContext && substance._matchContext.similarity">
          <span class = "simlarity-label">similarity:</span> <span class = "similarity">{{substance._matchContext.similarity.toFixed(3)}}</span>
        </div>
        <div class = 'definition' *ngIf = "substance.definitionLevel &&  substance.definitionLevel !== 'COMPLETE'">
          {{substance.definitionLevel }} DEFINITION
        </div>

        <button *ngIf="subunits" mat-icon-button [matMenuTriggerFor]="sequenceMenu" matTooltip = "sequence search">
          <mat-icon svgIcon="search"></mat-icon>
        </button>


        <mat-menu #sequenceMenu="matMenu">
          <a mat-menu-item *ngFor = "let unit of subunits; index as index" [routerLink]="['/sequence-search']"
             [queryParams]="{substance : substance.uuid, subunit : unit.uuid, seq_type : substance.substanceClass}">
            subunit {{unit.subunitIndex}} ({{unit.sequence && unit.sequence.length || 0}}) similarity search
          </a>
        </mat-menu>


        <mat-menu #downloadMenu="matMenu">
          <a mat-menu-item *ngIf="substance.structure"
            (click)="getMol(substance.uuid, (substance.approvalID? substance.approvalID.toString() : substance.uuid.toString())+'.mol')">
            <span>Download Molfile</span>
          </a>
          <a mat-menu-item *ngIf="substance.polymer"
            (click)="getMol(substance.uuid, (substance.approvalID? substance.approvalID.toString() : substance.uuid.toString())+'.mol')">
            <span>Download Molfile</span>
          </a>
          <a mat-menu-item *ngIf="(substance.protein || substance.nucleicAcid)"
            (click)="getFasta(substance.uuid, (substance.approvalID? substance.approvalID.toString() : substance.uuid.toString())+'.fas')">
            <span>Download Fasta</span>
          </a>
        </mat-menu>

        <mat-menu #searchMenu="matMenu">
          <a mat-menu-item *ngIf="substance.structure" [routerLink]="['/structure-search']"
            [queryParams]="{structure : substance.structure.id}">
            <span>Search Structure</span>
          </a>
          <a mat-menu-item *ngIf="substance.polymer" [routerLink]="['/structure-search']"
            [queryParams]="{structure : substance.polymer.displayStructure.id}">
            <span>Search Structure</span>
          </a>

        </mat-menu>

      </div>
      <div>
        <div class="substance-data substance-names" >
        <div class="substance-data substance-code-systems" *ngIf="codeSystems">
          <div class="label">Codes:</div>
          <div>
          <!--  <div class="margin-bottom" *ngFor="let codeSystemName of codeSystemNames | take: 5">-->
              <div class="code-system">
               <!-- <span class="label">{{codeSystemName | codeSystemDisplay | async}}</span>:&nbsp;-->
                <span class="value" *ngFor="let codeObject of codeSystems[codeSystemName]; last as isLast">
                  <span *ngIf="codeObject.url">
                    <a class="ext-link" target="_blank" [href]="codeObject.url" appTrackLinkEvent
                      evCategory="substancesContent" evAction="link:code" aria-label ="view site in new tab">
                      <span hidden>view site in new tab</span>{{codeObject.code.trim()}}
                      <!-- <mat-icon class="icon-align" svgIcon="link"></mat-icon>-->
                    </a>
                  </span>
                  <span *ngIf="!codeObject.url">{{codeObject.code.trim()}}</span>
                  <span *ngIf="!isLast">, </span>
                </span>
              </div>
           <!-- </div> -->
          </div>
        </div>
        <!--div class="substance-data substance-relationships"
          *ngIf="substance._relationships && substance._relationships.count != null">
          <div class="label">Relationships:</div>
          <div class="value">
            {{substance._relationships.count}}
          </div>
        </div-->
        <div class="substance-data" *ngIf="substance.protein && substance.protein.subunits">
          <div class="label">Subunits:</div>
          <div>
            <span class="value">{{substance.protein.subunits.length}}</span>
          </div>
        </div>
          <div class="substance-data" *ngIf="substance.nucleicAcid && substance.nucleicAcid.subunits">
            <div class="label">Subunits:</div>
            <div>
              <span class="value">{{substance.nucleicAcid.subunits.length}}</span>
            </div>
          </div>
        <div class="substance-data" *ngIf="substance.structurallyDiverse?.part">
          <div class="label">Part:</div>
          <div>
            <span class="blue-pill">
              <span *ngFor="let part of substance.structurallyDiverse.part; last as isLast">
                {{part}}
                <span *ngIf="!isLast">, </span>
              </span>
            </span>
          </div>
        </div>
      </div>
      
      <div > <!--*ngIf="names" class="substance-data substance-names"-->
        <!--div *ngIf='innName'>
          <div class="label">INN Name:</div>
          <div class="value space-bottom">
          {{ innName }}
          </div>
        </div-->
        <!--p *ngIf='usanName'>
          <span class="label">USAN Name:</span>
          <span class="value space-bottom">
          {{ usanName }}
          </span>
        </p>
        <p *ngIf='banName'>
          <span class="label" style="font-weight: bold;">BAN Name:</span>
          <span class="value space-bottom">
          {{ banName }}
          </span>
        </p>
        <p *ngIf='uspName'>
          <span class="label">USP Name:</span>
          <span class="value">
          {{ uspName }}
          </span>
        </p-->

        </div>


    </div>

    <table border="1px">
      <tr>
        <td width="20%" class="boldlabel">Pronounced</td>
        <td width="*">{{ pronName }}</td>
      </tr>
      <tr *ngIf='usanDate'>
        <td width="20%" class="boldlabel">USAN Year of Adoption</td>
        <td width="*">{{ usanDate }}</td>
      </tr>
      <tr>
        <td width="20%" class="boldlabel">Substance Class</td>
        <td width="*">{{substance.substanceClass }}</td>
      </tr>
      <tr>
        <th colspan="2" >Non-Proprietary Names</th>
      </tr>
      <tr>
        <td colspan="2"> 
          <table>
          <tr>
            <th width="33%">Official Names</th>
            <th width="33%">Common Names</th>
          </tr>
          <tr>
            <td style='border:"1px"'>
              <ul>
                <li *ngIf='usanName'>
                  <span class="boldlabel">USAN</span>
                  <span class="value space-bottom"> {{ usanName }}</span>
                </li>
                <li *ngIf='innName'>
                  <span class="boldlabel">INN</span>
                  <span class="value space-bottom"> {{ innName }}</span>
                </li>
                <li *ngIf='uspName'>
                  <span class="boldlabel">USP</span>
                  <span class="value">{{ uspName }}
                  </span>
                </li>
                <li *ngIf='banName'>
                  <span class="boldlabel" style="font-weight: bold;">BAN</span>
                  <span class="value space-bottom"> {{ banName }}</span>
                </li>
              </ul>
            </td>
            <td>
              <ul>
                <li *ngIf='iupacName'>
                  <span class="boldlabel">IUPAC Name:</span>
                  <span class="value"> {{ iupacName }}</span>
                </li>
                <li *ngIf='indexName'>
                  <span class="boldlabel">Index Name:</span>
                  <span class="value"> {{ indexName }}</span>
                </li>
                <li>
                  total {{ commonNames.length }} common names available
                </li>
              </ul>
              <div *ngIf='commonNames.length > MAX_NAMES_AT_ONCE '>
                <a (click)="toggleOtherNames()">...</a>
              </div>
              <div *ngIf='showOtherNames'>
                <div *ngFor = "let currentName of commonNames; index as index" >
                  <span name='otherNameName' class="value space-bottom">{{currentName.name}}</span>
                </div>
              </div>
          
            </td>
          </tr>
         </table>
        </td>
      </tr>
      <tr>
        <td class="boldlabel">Innovator Brand Names
        </td>
        <td> 
          <div *ngFor = "let mname of manufacturerNames">
            <span style="font-weight:bold;">{{mname.manufacturerName}}</span>
            <span> {{mname.substanceName}}</span>
          </div>
          <span *ngIf="manufacturerNames.length ===0">No innovator names</span>
        </td>

      </tr>
      <tr>
        <th>Identifiers</th>
        <td>
          <p *ngIf='usanId'>
            <span class="boldlabel">USAN</span>
            <span class="value space-bottom"> {{ usanId }}</span>
          </p>
          <p *ngIf='innId'>
            <span class="boldlabel">INN</span>
            <span class="value space-bottom"> {{ innId }}</span>
          </p>
          <p *ngIf='casRn'>
            <span class="boldlabel">CAS-RN®</span>
            <span class="value space-bottom"> {{ casRn }}</span>
          </p>
          <span class="boldlabel">UNII</span>
            <span *ngIf='substance.approvalID' class="value space-bottom"> {{ substance.approvalID }}</span>
          
            <span *ngIf='!substance.approvalID' class="value space-bottom"> {{ NO_DATA_STRING }}</span>
          <p *ngIf='otherCodes.length>0'>
            <a (click)="toggleOtherCodes()">...</a>
          </p>
          <div  id='otherCodes' *ngIf='showOtherCodes'>
            <div *ngFor = "let currentCode of otherCodes; index as index" >
              <span name='otherCodeSystem' class="boldlabel">{{currentCode.codeSystem}} </span> 
              <span name='otherCodeCode' class="value space-bottom">{{currentCode.code}}</span>
            </div>
          </div>
        </td>
      </tr>
      <tr >
        <td class="boldlabel"> Therapeutic Category</td>
        <td class="value space-bottom" >{{categoryName}}</td>
    </tr>
<tr *ngIf="substance.structure">
  <td class="boldlabel">Molecular Formula</td>
    <td class="value space-bottom" [innerHTML] = "substance.structure.formula"></td>
</tr>
  <tr>
    <td class="boldlabel">Molecular Weight</td> 
    <td class="value space-bottom"  >{{mwDisplay}}</td>
  </tr>

  <tr *ngFor = "let relationship of substance.relationships">
    <div *ngIf="requiredRelationshipTypes.indexOf(relationship.type) >-1">
    <th >{{relationship.type}}</th>
    <td > <!--*ngIf="relationship.type==='ACTIVE MOIETY'"-->
      <div class = "thumb-col">
        <div>{{relationship.relatedSubstance.linkingID}}</div>
        <img class="structure-image" appSubstanceImage [entityId]="relationship.relatedSubstance.refuuid">
        <div>
          <a class="substance-name" [routerLink]="['/substances', relationship.relatedSubstance.refuuid]" >
            {{relationship.relatedSubstance.name}}
          </a>
        </div>
      </div>
    </td>
  </div>
  </tr>
    </table>

      <div class="right-aligned">
        <!--div *ngIf = "inxightLink" class = "inxight-container">
            <a class = "ext-link" [href] = "inxightUrl" target ="_blank">
              Inxight Drugs <mat-icon class = "icon small-icon" svgIcon="open_in_new"></mat-icon>
            </a>
          </div>
          <div *ngIf="showAudit">
          <div class="substance-data">
            <div class="label">Created: </div>
            <div>
              <span class="value">
                {{substance.created | date : 'shortDate'}}
              </span>
            </div>
          </div>
          <div class="substance-data">
            <div class="label">Created By: </div>
            <div>
              <span class="value">
                {{substance.createdBy }}
              </span>
            </div>
          </div>
          <div class="substance-data">
            <div class="label">Status: </div>
            <div>
              <span class="value">
                {{substance.status === 'approved' ? 'Validated (UNII)' : 'pending'}}
              </span>
            </div>
          </div>
          <div class="substance-data" *ngIf = "substance.status === 'approved'">
            <div class="label">Validated By: </div>
            <div>
              <span class="value">
                {{substance.approvedBy }}
              </span>
            </div>
          </div>
          <div class="substance-data" *ngIf = "substance.approved">
            <div class="label">Validated Date: </div>
            <div>
              <span class="value">
                {{substance.approved| date : 'short'}}
              </span>
            </div>
          </div>
          <div class="substance-data">
            <div class="label">Last Modified: </div>
            <div>
              <span class="value">
                {{substance.lastEdited | date : 'shortDate'}}
              </span>
            </div>
          </div>
          <div class="substance-data">
            <div class="label">Last Modified By: </div>
            <div>
              <span class="value">
                {{substance.lastEditedBy }}
              </span>
            </div>
          </div>
          <div class="substance-data">
            <div class="label">Version: </div>
            <div>
              <span class="value">
                {{substance.version}}
              </span>
            </div>
          </div>
        </div-->
      </div>
    </div>
  </mat-card-content>
</mat-card>
