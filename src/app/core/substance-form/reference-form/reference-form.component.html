<div class="reference-form-container">
  <div *ngIf="isDeleted" class="notification-backdrop">
    Deleted
  </div>
  <div class="form-row">
    <mat-form-field class="source-type">
      <mat-label>Source Type *</mat-label>
      <mat-select [formControl]="documentTypeControl">
        <mat-option *ngFor="let documentType of documentTypes" [value]="documentType.value">
          {{documentType.display}}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="citation">
      <input matInput placeholder="Source Text/Citation *" [formControl]="citationControl" />
    </mat-form-field>
    <div class="checkbox-container">
      <mat-checkbox [formControl]="publicDomainControl">Public Domain</mat-checkbox>
    </div>
    <div>
      <app-access-manager (accessOut)="updateAccess($event)" [access]="reference.access">
      </app-access-manager>
    </div>
  </div>
  <div class="form-row">
    <mat-form-field class="url">
      <input matInput placeholder="URL" [formControl]="urlControl" />
    </mat-form-field>
    <mat-form-field>
      <input matInput placeholder="Source Id" [formControl]="idControl" />
    </mat-form-field>
    <app-tag-selector class="tags" (tagsUpdate)="updateTags($event)" [tags]="reference.tags"
      cvDomain="DOCUMENT_COLLECTION"></app-tag-selector>
  </div>
  <div class="form-row form-actions">
    <div *ngIf="reference.uuid">
      <button mat-button (click)="deleteReference()">
        <span>Delete</span>&nbsp;
        <mat-icon svgIcon="delete_forever"></mat-icon>
      </button>
    </div>
    <span class="fill-middle"></span>
    <div *ngIf="reference.uuid">
      <button mat-button [matMenuTriggerFor]="appliedOptionsMenu">
        <span>Apply to</span>&nbsp;
        <mat-icon svgIcon="menu"></mat-icon>
      </button>
      <mat-menu class="applied-menu-container" #appliedOptionsMenu="matMenu" xPosition="before">
        <button mat-menu-item (click)="referenceApplied.applyToAll()">
          <span>All</span>
        </button>
        <div *ngFor="let option of referenceApplied.options" mat-menu-item (click)="$event.stopPropagation()">
          <mat-checkbox (change)="referenceApplied.updateAppliedOtion($event, option.item)"
            [formControl]="option.control">
            {{option.display}}
          </mat-checkbox>
        </div>
        <ng-container *ngFor="let optionCategory of referenceApplied.optionCategories">
          <button mat-menu-item [matMenuTriggerFor]="optionsMenu">
            {{optionCategory.property}}
          </button>
          <mat-menu #optionsMenu="matMenu">
            <div *ngFor="let option of optionCategory.options" mat-menu-item (click)="$event.stopPropagation()">
              <mat-checkbox (change)="referenceApplied.updateAppliedOtion($event, option.item)"
                [formControl]="option.control">
                {{option.display}}
              </mat-checkbox>
            </div>
          </mat-menu>
        </ng-container>
      </mat-menu>
    </div>
  </div>
</div>