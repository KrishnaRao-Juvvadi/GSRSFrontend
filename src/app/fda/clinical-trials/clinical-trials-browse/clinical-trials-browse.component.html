<mat-sidenav-container [hasBackdrop]="hasBackdrop">
  <mat-sidenav [disableClose]="true" #matSideNavInstance mode="side" opened="true">
    <mat-accordion multi="true">
      <mat-expansion-panel *ngFor="let facet of facets; index as topIndex" [expanded]="false || facetParams[facet.name] != null">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{facet.name | facetDisplay}}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-form-field class="">
          <input matInput class="search" type="text" [ngModel] = "searchText[facet.name]" (ngModelChange) = "filterFacets(topIndex, $event)"
            placeholder="Search  {{facet.name}}">
        </mat-form-field>
        <button mat-icon-button color="black" (click) = "searchText[facet.name] = ''"><mat-icon svgIcon="close"></mat-icon></button>
          <ng-container  *ngFor="let value of facet.values | facetFilter : searchText[facet.name]; index as index">
            <div class="facet-value" >
          <div class="facet-value-checkbox">
            <mat-checkbox class="include" matTooltip="Include"
              (change)="updateFacetSelection($event, facet.name, value.label, true)"
              [checked]="facetParams[facet.name] != null && facetParams[facet.name].params[value.label] == true">
            </mat-checkbox>
            <mat-checkbox class="exclude" matTooltip="Exclude"
              (change)="updateFacetSelection($event, facet.name, value.label, false)"
              [checked]="facetParams[facet.name] != null && facetParams[facet.name].params[value.label] == false">
            </mat-checkbox>
          </div>
          <div class="facet-value-label">
            <span *ngIf="facet.name !== 'Substance Class' && facet.name !== 'Record Status'">
              {{value.label}}
            </span>
            <span *ngIf = "facet.name === 'Substance Class'">
              {{value.label | facetDisplay: 'types'}}
            </span>
            <span *ngIf="facet.name === 'Record Status'">
              {{value.label | facetDisplay: 'status'}}
            </span>
          </div>
          <div class="middle-fill"></div>
          <div class="facet-value-count">
            {{value.count}}
          </div>
            </div>
        </ng-container>
        <div>
         <!--- <a class="show-more" (click)="toggle[topIndex] = !toggle[topIndex]" *ngIf = "facet.values.length > 10">
            Show {{toggle[topIndex] === true ? 'all': 'less'}}
          </a>-->
          <span  *ngIf = "facet.values && facet.values.length >= 10 && (
           !searchText[facet.name] || searchText[facet.name] == '')">
             <a class="show-more" (click)="moreFacets(topIndex, facet)" *ngIf ="(!facet.$total ||
              facet.$total > facet.values.length)">
            More...{{searchText[facet.name]}}
          </a>
             <a class="show-more" *ngIf = "facet.values.length > 10" (click)="lessFacets(topIndex)">
            Show Less {{searchText[facet.name]}}
          </a>
          </span>

        </div>
        <div class="facet-actions" *ngIf="facetParams[facet.name] != null">
          <mat-checkbox *ngIf="facetParams[facet.name] && facetParams[facet.name].showAllMatchOption"
            [(ngModel)]="facetParams[facet.name].isAllMatch" (click)="sendFacetsEvent($event, facet.name)">
            All Match
          </mat-checkbox>
          <div class="pull-right">
            <button *ngIf="facetParams[facet.name].hasSelections" mat-flat-button [disabled]="isLoading" (click)="clearFacetSelection(facet.name)">
              Clear
            </button>
            <button *ngIf="facetParams[facet.name].isUpdated" class="apply-button" mat-flat-button color="primary" [disabled]="isLoading"
              (click)="applyFacetsFilter(facet.name)">
              Apply
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </mat-sidenav>
<mat-sidenav-content>

<div class="example-container mat-elevation-z8 clinical-trials-browse-wrapper">
    <h3>Browse Clinical Trials</h3>
    <div>
    <form class="filter-form clinical-trials-browse-filter-form">
      <mat-form-field class='clinical-trials-browse-filter-form-searchTerm'>
        <input matInput placeholder="Search Term" [(ngModel)]="searchTerm" name="searchTerm" (keyup.enter)="setSearchTermValue();" />
      </mat-form-field>
      
      <mat-form-field class='clinical-trials-browse-filter-form-searchType'>
        <mat-label>Type</mat-label>
        <mat-select  [(ngModel)]="searchType" name="searchType">
          <mat-option *ngFor="let searchType of searchTypes" [value]="searchType.value">
            {{searchType.title}}
         </mat-option>
        </mat-select>
      </mat-form-field>
     <button mat-flat-button color="primary" class="clinical-trials-browse-filter-form-button-open"  matSuffix aria-label="Search Clinical Trials" (click)="setSearchTermValue();">Go</button>
     <span *ngIf="!showHelp">
      <button mat-icon-button aria-label="Show Help" (click)="toggleShowHelp()">?</button>
    </span>
    </form>
    <mat-card style="float: left; clear: both;" *ngIf="showHelp" class='show-help-box'>
      <div style="display: flex">
      <span class="middle-fill"></span>
      <button class="clinical-trials-browse-filter-form-help-button-close" mat-icon-button (click)="toggleShowHelp()">
        <mat-icon svgIcon="close"></mat-icon>
      </button>
      </div>
      <div>
        <p><strong>All</strong> - search in all indexed fields; wild cards work (e.g health*).</p>
        <p><strong>Title</strong> - search for full words contained in the title field.</p>
        <p><strong>NCT Number</strong> - search for NCT Number exactly.</p>
      </div>
    </mat-card>
  </div>
    <div>
      <mat-paginator #paginator [length]="totalClinicalTrials" [pageIndex]="pageIndex" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 50, 100]"
      (page)="changePage($event)">
    </mat-paginator>
    </div>
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
        

      <!--- Note that these columns can be defined in any order.
            The actual rendered columns are set as a property on the row definition" -->
    
    
     <!-- edit Column -->
     
     <ng-container matColumnDef="edit">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
            <a class="clinical-trials-browse-edit1"  title="Edit in this tab" [routerLink]="['/edit-clinical-trial', element.nctNumber]" [queryParams]="{}" >Edit</a>&nbsp;<a class="clinical-trials-browse-edit2" target="_blank" title="Edit in new tab" [href]="'edit-clinical-trial/' + element.nctNumber">+</a>
          </td>
      </ng-container>
      
    <!-- nctNumber Column -->
      <ng-container matColumnDef="nctNumber">
        <th mat-header-cell *matHeaderCellDef>nctNumber</th>
        <td mat-cell *matCellDef="let element">
          <a target="_blank" title="see clinicaltrials.gov" [href]="'https://clinicaltrials.gov/ct2/show/' + element.nctNumber">{{element.nctNumber}}</a>
        </td>
      </ng-container>
    
      <!-- title Column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>title</th>
        <td mat-cell *matCellDef="let element">
          {{element.title}}
          <span *ngIf="element.clinicalTrialDrug"> ({{element.clinicalTrialDrug.length}}) </span>                    
        </td>
      </ng-container>
    
      <!-- ID Column -->
      <ng-container matColumnDef="lastUpdated">
        <th mat-header-cell *matHeaderCellDef>lastUpdated</th>
        <td mat-cell *matCellDef="let element">{{element.lastUpdated|date: 'MM/dd/yyyy'}} </td>
      </ng-container>
    
      <ng-container matColumnDef="delete">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element; let index = index">
              <button mat-icon-button matSuffix aria-label="Del" (click)="deleteClinicalTrial(index);">Del</button>
            </td>
        </ng-container>
      
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>  
    </table>
    <div>
      <mat-paginator #paginator [length]="totalClinicalTrials" [pageIndex]="pageIndex" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 50, 100]"
      (page)="changePage($event)">
    </mat-paginator>
    </div>
  </div>
</mat-sidenav-content>
</mat-sidenav-container>